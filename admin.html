<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة الإدارة - نظام إدارة الانتظار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .sidebar {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .notification {
            animation: slideInDown 0.5s ease-out;
        }
        @keyframes slideInDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <i class="fas fa-hospital text-2xl text-blue-600 ml-3"></i>
                        <span class="text-xl font-bold text-gray-800">نظام إدارة الانتظار</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <span class="text-gray-600">لوحة الإدارة</span>
                    <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-sign-out-alt ml-1"></i>
                        خروج
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex pt-16 min-h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-64 text-white">
            <div class="p-6">
                <div class="text-center mb-8">
                    <i class="fas fa-user-cog text-4xl mb-4"></i>
                    <h2 class="text-xl font-bold">لوحة الإدارة</h2>
                </div>
                
                <nav class="space-y-2">
                    <button onclick="showSection('basic-info')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-info-circle ml-2"></i>
                        البيانات الأساسية
                    </button>
                    <button onclick="showSection('news-ticker')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-scroll ml-2"></i>
                        الشريط الإخباري
                    </button>
                    <button onclick="showSection('clinics')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-hospital-alt ml-2"></i>
                        إدارة العيادات
                    </button>
                    <button onclick="showSection('audio-settings')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-volume-up ml-2"></i>
                        الإعدادات الصوتية
                    </button>
                    <button onclick="showSection('video-settings')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-video ml-2"></i>
                        الإعدادات المرئية
                    </button>
                    <button onclick="showSection('system-controls')" class="nav-btn w-full text-right px-4 py-3 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-cogs ml-2"></i>
                        التحكم في النظام
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Basic Info Section -->
            <div id="basic-info" class="section">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-info-circle text-blue-600 ml-3"></i>
                        البيانات الأساسية
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">اسم المركز الطبي</label>
                            <input type="text" id="centerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="أدخل اسم المركز الطبي">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">مدة عرض التنبيه (بالثواني)</label>
                            <input type="number" id="alertDuration" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="5" min="1" max="30">
                        </div>
                    </div>
                    
                    <button onclick="saveBasicInfo()" class="mt-6 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-save ml-2"></i>
                        حفظ البيانات
                    </button>
                </div>
            </div>

            <!-- News Ticker Section -->
            <div id="news-ticker" class="section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-scroll text-green-600 ml-3"></i>
                        إعدادات الشريط الإخباري
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">محتوى الشريط الإخباري</label>
                            <textarea id="newsContent" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="أدخل محتوى الشريط الإخباري..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">سرعة الحركة (بالثواني)</label>
                            <input type="range" id="newsSpeed" min="10" max="60" value="30" class="w-full">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>سريع</span>
                                <span>بطيء</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveNewsSettings()" class="mt-6 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-save ml-2"></i>
                        حفظ الإعدادات
                    </button>
                </div>
            </div>

            <!-- Clinics Management Section -->
            <div id="clinics" class="section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-hospital-alt text-purple-600 ml-3"></i>
                            إدارة العيادات
                        </h2>
                        <button onclick="addClinic()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة عيادة
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الاسم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الرقم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الشاشة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">كلمة السر</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="clinicsTable" class="bg-white divide-y divide-gray-200">
                                <!-- Clinics will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Audio Settings Section -->
            <div id="audio-settings" class="section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-volume-up text-indigo-600 ml-3"></i>
                        الإعدادات الصوتية
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">سرعة نطق النداء</label>
                            <input type="range" id="speechSpeed" min="0.5" max="2" step="0.1" value="1" class="w-full">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>بطيء</span>
                                <span>عادي</span>
                                <span>سريع</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">مسار ملفات الصوت</label>
                            <input type="text" id="audioPath" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="audio/">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">تسجيل صوت مخصص</label>
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <button onclick="startRecording()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                    <i class="fas fa-microphone ml-2"></i>
                                    بدء التسجيل
                                </button>
                                <button onclick="stopRecording()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors" disabled>
                                    <i class="fas fa-stop ml-2"></i>
                                    إيقاف التسجيل
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="saveAudioSettings()" class="mt-6 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-save ml-2"></i>
                        حفظ الإعدادات
                    </button>
                </div>
            </div>

            <!-- Video Settings Section -->
            <div id="video-settings" class="section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-video text-red-600 ml-3"></i>
                        الإعدادات المرئية
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">مسار ملفات الفيديو</label>
                            <input type="text" id="videoPath" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="media/">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">قائمة ملفات الفيديو</label>
                            <div id="videoList" class="space-y-2">
                                <!-- Video files will be listed here -->
                            </div>
                            <button onclick="refreshVideoList()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-refresh ml-2"></i>
                                تحديث القائمة
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="saveVideoSettings()" class="mt-6 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-save ml-2"></i>
                        حفظ الإعدادات
                    </button>
                </div>
            </div>

            <!-- System Controls Section -->
            <div id="system-controls" class="section hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-cogs text-orange-600 ml-3"></i>
                        التحكم في النظام
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <button onclick="callSpecificPatient()" class="bg-blue-500 text-white px-6 py-4 rounded-lg hover:bg-blue-600 transition-colors card-hover">
                            <i class="fas fa-bullhorn text-2xl mb-2"></i>
                            <div>نداء عميل محدد</div>
                        </button>
                        
                        <button onclick="playAlertSound()" class="bg-green-500 text-white px-6 py-4 rounded-lg hover:bg-green-600 transition-colors card-hover">
                            <i class="fas fa-bell text-2xl mb-2"></i>
                            <div>تشغيل تنبيه</div>
                        </button>
                        
                        <button onclick="playAudioFile()" class="bg-purple-500 text-white px-6 py-4 rounded-lg hover:bg-purple-600 transition-colors card-hover">
                            <i class="fas fa-play text-2xl mb-2"></i>
                            <div>إذاعة ملف صوتي</div>
                        </button>
                        
                        <button onclick="resetAllClinics()" class="bg-red-500 text-white px-6 py-4 rounded-lg hover:bg-red-600 transition-colors card-hover">
                            <i class="fas fa-refresh text-2xl mb-2"></i>
                            <div>تصفير جميع العيادات</div>
                        </button>
                        
                        <button onclick="sendEmergencyAlert()" class="bg-orange-500 text-white px-6 py-4 rounded-lg hover:bg-orange-600 transition-colors card-hover">
                            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                            <div>تنبيه طوارئ</div>
                        </button>
                        
                        <button onclick="systemRestart()" class="bg-gray-500 text-white px-6 py-4 rounded-lg hover:bg-gray-600 transition-colors card-hover">
                            <i class="fas fa-power-off text-2xl mb-2"></i>
                            <div>إعادة تشغيل النظام</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Bar -->
    <div id="notificationBar" class="notification fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <i class="fas fa-check-circle ml-2"></i>
        <span id="notificationText">تم الحفظ بنجاح</span>
    </div>

    <!-- Clinic Modal -->
    <div id="clinicModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">إضافة/تعديل عيادة</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">اسم العيادة</label>
                    <input type="text" id="clinicName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">رقم العيادة</label>
                    <input type="number" id="clinicNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">رقم الشاشة</label>
                    <input type="number" id="screenNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">كلمة السر</label>
                    <input type="password" id="clinicPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
            </div>
            <div class="flex justify-end space-x-4 space-x-reverse mt-6">
                <button onclick="closeClinicModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">إلغاء</button>
                <button onclick="saveClinic()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">حفظ</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            databaseURL: "your-database-url",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        if (typeof firebase !== 'undefined') {
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
        }

        // Global variables
        let currentClinicId = null;
        let isRecording = false;
        let mediaRecorder = null;

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-white/20');
            });
            event.target.classList.add('bg-white/20');
        }

        // Basic Info Functions
        function saveBasicInfo() {
            const centerName = document.getElementById('centerName').value;
            const alertDuration = document.getElementById('alertDuration').value;
            
            if (typeof firebase !== 'undefined') {
                database.ref('settings').update({
                    centerName: centerName,
                    alertDuration: parseInt(alertDuration)
                }).then(() => {
                    showNotification('تم حفظ البيانات الأساسية بنجاح');
                });
            } else {
                // Local storage fallback
                localStorage.setItem('centerName', centerName);
                localStorage.setItem('alertDuration', alertDuration);
                showNotification('تم حفظ البيانات الأساسية بنجاح');
            }
        }

        // News Settings Functions
        function saveNewsSettings() {
            const newsContent = document.getElementById('newsContent').value;
            const newsSpeed = document.getElementById('newsSpeed').value;
            
            if (typeof firebase !== 'undefined') {
                database.ref('settings/news').update({
                    content: newsContent,
                    speed: parseInt(newsSpeed)
                }).then(() => {
                    showNotification('تم حفظ إعدادات الشريط الإخباري');
                });
            } else {
                localStorage.setItem('newsContent', newsContent);
                localStorage.setItem('newsSpeed', newsSpeed);
                showNotification('تم حفظ إعدادات الشريط الإخباري');
            }
        }

        // Clinic Management Functions
        function addClinic() {
            currentClinicId = null;
            document.getElementById('clinicName').value = '';
            document.getElementById('clinicNumber').value = '';
            document.getElementById('screenNumber').value = '';
            document.getElementById('clinicPassword').value = '';
            document.getElementById('clinicModal').classList.remove('hidden');
        }

        function editClinic(id, name, number, screen, password) {
            currentClinicId = id;
            document.getElementById('clinicName').value = name;
            document.getElementById('clinicNumber').value = number;
            document.getElementById('screenNumber').value = screen;
            document.getElementById('clinicPassword').value = password;
            document.getElementById('clinicModal').classList.remove('hidden');
        }

        function closeClinicModal() {
            document.getElementById('clinicModal').classList.add('hidden');
        }

        function saveClinic() {
            const clinicData = {
                name: document.getElementById('clinicName').value,
                number: parseInt(document.getElementById('clinicNumber').value),
                screen: parseInt(document.getElementById('screenNumber').value),
                password: document.getElementById('clinicPassword').value,
                currentNumber: 0,
                status: 'active'
            };

            if (typeof firebase !== 'undefined') {
                const clinicRef = currentClinicId ? 
                    database.ref('clinics/' + currentClinicId) : 
                    database.ref('clinics').push();
                
                clinicRef.set(clinicData).then(() => {
                    closeClinicModal();
                    loadClinics();
                    showNotification('تم حفظ العيادة بنجاح');
                });
            } else {
                // Local storage fallback
                let clinics = JSON.parse(localStorage.getItem('clinics') || '[]');
                if (currentClinicId) {
                    const index = clinics.findIndex(c => c.id === currentClinicId);
                    clinics[index] = { ...clinicData, id: currentClinicId };
                } else {
                    clinics.push({ ...clinicData, id: Date.now().toString() });
                }
                localStorage.setItem('clinics', JSON.stringify(clinics));
                closeClinicModal();
                loadClinics();
                showNotification('تم حفظ العيادة بنجاح');
            }
        }

        function deleteClinic(id) {
            if (confirm('هل أنت متأكد من حذف هذه العيادة؟')) {
                if (typeof firebase !== 'undefined') {
                    database.ref('clinics/' + id).remove().then(() => {
                        loadClinics();
                        showNotification('تم حذف العيادة بنجاح');
                    });
                } else {
                    let clinics = JSON.parse(localStorage.getItem('clinics') || '[]');
                    clinics = clinics.filter(c => c.id !== id);
                    localStorage.setItem('clinics', JSON.stringify(clinics));
                    loadClinics();
                    showNotification('تم حذف العيادة بنجاح');
                }
            }
        }

        function loadClinics() {
            const clinicsTable = document.getElementById('clinicsTable');
            
            if (typeof firebase !== 'undefined') {
                database.ref('clinics').once('value').then(snapshot => {
                    const clinics = snapshot.val() || {};
                    displayClinics(clinics);
                });
            } else {
                const clinics = JSON.parse(localStorage.getItem('clinics') || '[]');
                const clinicsObj = {};
                clinics.forEach(clinic => {
                    clinicsObj[clinic.id] = clinic;
                });
                displayClinics(clinicsObj);
            }
        }

        function displayClinics(clinics) {
            const clinicsTable = document.getElementById('clinicsTable');
            clinicsTable.innerHTML = '';
            
            Object.keys(clinics).forEach(id => {
                const clinic = clinics[id];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${clinic.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${clinic.number}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${clinic.screen}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${clinic.password}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editClinic('${id}', '${clinic.name}', ${clinic.number}, ${clinic.screen}, '${clinic.password}')" class="text-blue-600 hover:text-blue-900 ml-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteClinic('${id}')" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                clinicsTable.appendChild(row);
            });
        }

        // Audio Settings Functions
        function saveAudioSettings() {
            const speechSpeed = document.getElementById('speechSpeed').value;
            const audioPath = document.getElementById('audioPath').value;
            
            if (typeof firebase !== 'undefined') {
                database.ref('settings/audio').update({
                    speechSpeed: parseFloat(speechSpeed),
                    audioPath: audioPath
                }).then(() => {
                    showNotification('تم حفظ الإعدادات الصوتية');
                });
            } else {
                localStorage.setItem('speechSpeed', speechSpeed);
                localStorage.setItem('audioPath', audioPath);
                showNotification('تم حفظ الإعدادات الصوتية');
            }
        }

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    isRecording = true;
                    
                    document.querySelector('[onclick="startRecording()"]').disabled = true;
                    document.querySelector('[onclick="stopRecording()"]').disabled = false;
                    
                    showNotification('تم بدء التسجيل');
                })
                .catch(err => {
                    showNotification('فشل في الوصول للميكروفون', 'error');
                });
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                document.querySelector('[onclick="startRecording()"]').disabled = false;
                document.querySelector('[onclick="stopRecording()"]').disabled = true;
                
                showNotification('تم إيقاف التسجيل');
            }
        }

        // Video Settings Functions
        function saveVideoSettings() {
            const videoPath = document.getElementById('videoPath').value;
            
            if (typeof firebase !== 'undefined') {
                database.ref('settings/video').update({
                    videoPath: videoPath
                }).then(() => {
                    showNotification('تم حفظ الإعدادات المرئية');
                });
            } else {
                localStorage.setItem('videoPath', videoPath);
                showNotification('تم حفظ الإعدادات المرئية');
            }
        }

        function refreshVideoList() {
            // This would typically scan the video directory
            // For now, we'll simulate with some example files
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span>video1.mp4</span>
                    <button class="text-red-500 hover:text-red-700">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span>video2.mp4</span>
                    <button class="text-red-500 hover:text-red-700">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            `;
        }

        // System Control Functions
        function callSpecificPatient() {
            const clinicId = prompt('أدخل رقم العيادة:');
            const patientNumber = prompt('أدخل رقم المريض:');
            
            if (clinicId && patientNumber) {
                if (typeof firebase !== 'undefined') {
                    database.ref('calls').push({
                        clinicId: clinicId,
                        patientNumber: parseInt(patientNumber),
                        timestamp: Date.now()
                    });
                }
                showNotification(`تم النداء على المريض رقم ${patientNumber} في العيادة ${clinicId}`);
            }
        }

        function playAlertSound() {
            // Play alert sound
            const audio = new Audio('audio/ding.mp3');
            audio.play().catch(e => console.log('Could not play audio:', e));
            showNotification('تم تشغيل التنبيه');
        }

        function playAudioFile() {
            const fileName = prompt('أدخل اسم ملف الصوت:');
            if (fileName) {
                const audio = new Audio(`audio/${fileName}`);
                audio.play().catch(e => console.log('Could not play audio:', e));
                showNotification(`تم تشغيل ملف ${fileName}`);
            }
        }

        function resetAllClinics() {
            if (confirm('هل أنت متأكد من تصفير جميع العيادات؟')) {
                if (typeof firebase !== 'undefined') {
                    database.ref('clinics').once('value').then(snapshot => {
                        const clinics = snapshot.val() || {};
                        const updates = {};
                        Object.keys(clinics).forEach(id => {
                            updates[`clinics/${id}/currentNumber`] = 0;
                        });
                        database.ref().update(updates);
                    });
                } else {
                    let clinics = JSON.parse(localStorage.getItem('clinics') || '[]');
                    clinics = clinics.map(clinic => ({ ...clinic, currentNumber: 0 }));
                    localStorage.setItem('clinics', JSON.stringify(clinics));
                }
                showNotification('تم تصفير جميع العيادات');
            }
        }

        function sendEmergencyAlert() {
            const message = prompt('أدخل رسالة التنبيه:');
            if (message) {
                if (typeof firebase !== 'undefined') {
                    database.ref('emergency').push({
                        message: message,
                        timestamp: Date.now()
                    });
                }
                showNotification('تم إرسال تنبيه الطوارئ');
            }
        }

        function systemRestart() {
            if (confirm('هل أنت متأكد من إعادة تشغيل النظام؟')) {
                showNotification('جاري إعادة تشغيل النظام...');
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }

        // Notification function
        function showNotification(message, type = 'success') {
            const notificationBar = document.getElementById('notificationBar');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notificationBar.className = `notification fixed top-20 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            } text-white`;
            
            notificationBar.classList.remove('hidden');
            
            setTimeout(() => {
                notificationBar.classList.add('hidden');
            }, 3000);
        }

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                localStorage.removeItem('adminLoggedIn');
                window.location.href = 'index.html';
            }
        });

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in
            if (!localStorage.getItem('adminLoggedIn')) {
                // For demo purposes, we'll allow access
                localStorage.setItem('adminLoggedIn', 'true');
            }
            
            // Load existing data
            loadClinics();
            
            // Load settings from localStorage
            document.getElementById('centerName').value = localStorage.getItem('centerName') || '';
            document.getElementById('alertDuration').value = localStorage.getItem('alertDuration') || '5';
            document.getElementById('newsContent').value = localStorage.getItem('newsContent') || '';
            document.getElementById('newsSpeed').value = localStorage.getItem('newsSpeed') || '30';
            document.getElementById('speechSpeed').value = localStorage.getItem('speechSpeed') || '1';
            document.getElementById('audioPath').value = localStorage.getItem('audioPath') || 'audio/';
            document.getElementById('videoPath').value = localStorage.getItem('videoPath') || 'media/';
        });
    </script>
</body>
</html>